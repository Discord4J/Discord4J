<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Migration Guides/migrating-from-v3-0-to-v3-1" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Migrating from v3.0 to v3.1 | Discord4J</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://discord4j.com/migrating-from-v3-0-to-v3-1"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Migrating from v3.0 to v3.1 | Discord4J"><meta data-rh="true" name="description" content="Before you start"><meta data-rh="true" property="og:description" content="Before you start"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://discord4j.com/migrating-from-v3-0-to-v3-1"><link data-rh="true" rel="alternate" href="https://discord4j.com/migrating-from-v3-0-to-v3-1" hreflang="en"><link data-rh="true" rel="alternate" href="https://discord4j.com/migrating-from-v3-0-to-v3-1" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://C7ZMMWOOHU-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-100029628-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-100029628-1",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Discord4J" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.f8f5dca9.css">
<script src="/assets/js/runtime~main.a61b7613.js" defer="defer"></script>
<script src="/assets/js/main.dd0e6ff0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Discord4J Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Discord4J Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Discord4J</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Welcome to Discord4J Docs!</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quickstart">Quickstart</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/discord-application-tutorial">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/interactions/application-commands">How-to Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/examples">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/lambda-tutorial">Conceptual Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/migrating-from-v2-x-to-v3-1">Migration Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/migrating-from-v2-x-to-v3-1">Migrating from v2.x to v3.1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/migrating-from-v3-0-to-v3-1">Migrating from v3.0 to v3.1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/migrating-from-v3-1-to-v3-2">Migrating from v3.1 to v3.2</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Migration Guides</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Migrating from v3.0 to v3.1</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Migrating from v3.0 to v3.1</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="before-you-start">Before you start<a href="#before-you-start" class="hash-link" aria-label="Direct link to Before you start" title="Direct link to Before you start">​</a></h2>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>If you encounter an issue while following this guide or discover something missing, feel free to suggest changes or discuss them in our <a href="https://discord.gg/d4j" target="_blank" rel="noopener noreferrer">server</a>. Thanks!</p></div></div>
<p>This document is meant to help you migrate your application to Discord4J v3.1 if you&#x27;re already on v3.0. If not, please check our <a href="/migrating-from-v2-x-to-v3-1">guild</a> first.</p>
<p>Discord4J is transitioning to a new architecture where users are able to work with the library REST capabilities separately from real-time Gateway operations in an easier way than before.</p>
<p>In addition, spawning Gateway connections is treated separately from <code>DiscordClient</code>, allowing users to have all joining shards publish events and entities to a single location, removing the need of using separate classes for handling multiple shards in a single process.</p>
<p>While this means that a single <code>EventDispatcher</code> and <code>StateHolder</code> are shared across all shards controlled by a single <code>GatewayDiscordClient</code>, you are in control of what shards are connected to it (<code>DiscordClient</code> + Gateway capabilities = <code>GatewayDiscordClient</code>). This enables you to more easily setup distributed architectures where certain actions are coordinated even across multiple JVMs.</p>
<p>For a more in-depth explanation of the new features and changes introduced check <a href="/whats-new-in-v3-1">What&#x27;s new in v3.1</a> and <a href="/glossary">glossary</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="updating-dependencies">Updating dependencies<a href="#updating-dependencies" class="hash-link" aria-label="Direct link to Updating dependencies" title="Direct link to Updating dependencies">​</a></h2>
<p>Discord4J v3.1 depends on Reactor Dysprosium release train (<a href="https://github.com/reactor/reactor-core" target="_blank" rel="noopener noreferrer">Reactor Core</a> 3.3.x and <a href="https://github.com/reactor/reactor-netty" target="_blank" rel="noopener noreferrer">Reactor Netty</a> 0.9.x).</p>
<p>One important change in Reactor is the addition of the <code>Schedulers.boundedElastic()</code> scheduler that caps the number of threads. It should help for cases when you do blocking operations whilst keeping a limit on the amount of threads created.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gradle">Gradle<a href="#gradle" class="hash-link" aria-label="Direct link to Gradle" title="Direct link to Gradle">​</a></h3>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#a9b7c6;--prism-background-color:#2b2b2b"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="color:#a9b7c6;background-color:#2b2b2b"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#a9b7c6"><span class="token plain">repositories </span><span class="token punctuation" style="color:#a9b7c6">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">  </span><span class="token function" style="color:#ffc66d">mavenCentral</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain"></span><span class="token punctuation" style="color:#a9b7c6">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">dependencies </span><span class="token punctuation" style="color:#a9b7c6">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">  implementation </span><span class="token string" style="color:#6a8759">&#x27;com.discord4j:discord4j-core:3.1.0&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain"></span><span class="token punctuation" style="color:#a9b7c6">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="maven">Maven<a href="#maven" class="hash-link" aria-label="Direct link to Maven" title="Direct link to Maven">​</a></h3>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#a9b7c6;--prism-background-color:#2b2b2b"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#a9b7c6;background-color:#2b2b2b"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#a9b7c6"><span class="token tag punctuation" style="color:#a9b7c6">&lt;</span><span class="token tag" style="color:#e8bf6a">dependencies</span><span class="token tag punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token tag punctuation" style="color:#a9b7c6">&lt;</span><span class="token tag" style="color:#e8bf6a">dependency</span><span class="token tag punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token tag punctuation" style="color:#a9b7c6">&lt;</span><span class="token tag" style="color:#e8bf6a">groupId</span><span class="token tag punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain">com.discord4j</span><span class="token tag punctuation" style="color:#a9b7c6">&lt;/</span><span class="token tag" style="color:#e8bf6a">groupId</span><span class="token tag punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token tag punctuation" style="color:#a9b7c6">&lt;</span><span class="token tag" style="color:#e8bf6a">artifactId</span><span class="token tag punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain">discord4j-core</span><span class="token tag punctuation" style="color:#a9b7c6">&lt;/</span><span class="token tag" style="color:#e8bf6a">artifactId</span><span class="token tag punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token tag punctuation" style="color:#a9b7c6">&lt;</span><span class="token tag" style="color:#e8bf6a">version</span><span class="token tag punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain">3.1.0</span><span class="token tag punctuation" style="color:#a9b7c6">&lt;/</span><span class="token tag" style="color:#e8bf6a">version</span><span class="token tag punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token tag punctuation" style="color:#a9b7c6">&lt;/</span><span class="token tag" style="color:#e8bf6a">dependency</span><span class="token tag punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain"></span><span class="token tag punctuation" style="color:#a9b7c6">&lt;/</span><span class="token tag" style="color:#e8bf6a">dependencies</span><span class="token tag punctuation" style="color:#a9b7c6">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Quick migration</h1>
<p>Most notable change from v3.0 to v3.1 is the behavior of the <code>login()</code> method. We feel that the method makes most sense if it returns a <code>Mono</code> that completes as login is completed, instead of logout, and to return a handle for the underlying gateway connections.</p>
<p>This change is needed to allow separation between a <code>DiscordClient</code> and the real-time Gateway, represented by a <code>GatewayDiscordClient</code>. To acquire one and perform actions with a bot, you need to login to the Gateway first.</p>
<p>Following is the quickstart example from v3.0 migrated to v3.1 as a starting point. Just move the code you had before <code>login()</code> into the <code>.withGateway(client -&gt; ...)</code> block and add <code>return client.onDisconnect()</code>.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#a9b7c6;--prism-background-color:#2b2b2b"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#a9b7c6;background-color:#2b2b2b"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#a9b7c6"><span class="token class-name">DiscordClientBuilder</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">create</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">System</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getenv</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;token&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">build</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">withGateway</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">client </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#a9b7c6">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        client</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getEventDispatcher</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">on</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">ReadyEvent</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token keyword" style="color:#cc7832">class</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">subscribe</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">ready </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                    </span><span class="token class-name">System</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">println</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;Logged in as &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#a9b7c6">+</span><span class="token plain"> ready</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getSelf</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getUsername</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        client</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getEventDispatcher</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">on</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">MessageCreateEvent</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token keyword" style="color:#cc7832">class</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">map</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">MessageCreateEvent</span><span class="token operator" style="color:#a9b7c6">::</span><span class="token function" style="color:#ffc66d">getMessage</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">filter</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">msg </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getContent</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">equals</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;!ping&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">flatMap</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">Message</span><span class="token operator" style="color:#a9b7c6">::</span><span class="token function" style="color:#ffc66d">getChannel</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">flatMap</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">channel </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">createMessage</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;Pong!&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">subscribe</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token keyword" style="color:#cc7832">return</span><span class="token plain"> client</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">onDisconnect</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">}</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">block</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As you could have noticed, another important change is the return type of the <code>Message::getContent()</code> method. Starting from v3.1 this method will return <code>String</code> instead of <code>Optional&lt;String&gt;</code>. This means that to directly migrate you now have to wrap <code>message.getContent()</code> like this: <code>Optional.of(message.getContent())</code></p>
<p>If the IDE warns you when calling <code>subscribe</code>, it&#x27;s because the sequences could be wired together instead of calling <code>.subscribe()</code> within a reactive pipeline. To remove them you can transform the code into:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#a9b7c6;--prism-background-color:#2b2b2b"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#a9b7c6;background-color:#2b2b2b"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#a9b7c6"><span class="token class-name">DiscordClientBuilder</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">create</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">System</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getenv</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;token&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">build</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">withGateway</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">client </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#a9b7c6">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">            </span><span class="token class-name">Mono</span><span class="token generics punctuation" style="color:#a9b7c6">&lt;</span><span class="token generics class-name">Void</span><span class="token generics punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain"> onReady </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getEventDispatcher</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">on</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">ReadyEvent</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token keyword" style="color:#cc7832">class</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">doOnNext</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">ready </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                        </span><span class="token class-name">System</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">println</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                            </span><span class="token string" style="color:#6a8759">&quot;Logged in as &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#a9b7c6">+</span><span class="token plain"> ready</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getSelf</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getUsername</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                        </span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                    </span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">then</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">            </span><span class="token class-name">Mono</span><span class="token generics punctuation" style="color:#a9b7c6">&lt;</span><span class="token generics class-name">Void</span><span class="token generics punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain"> ping </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getEventDispatcher</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">on</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">MessageCreateEvent</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token keyword" style="color:#cc7832">class</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">map</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">MessageCreateEvent</span><span class="token operator" style="color:#a9b7c6">::</span><span class="token function" style="color:#ffc66d">getMessage</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">filter</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">msg </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> msg</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getContent</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">equals</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;!ping&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">flatMap</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">Message</span><span class="token operator" style="color:#a9b7c6">::</span><span class="token function" style="color:#ffc66d">getChannel</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">flatMap</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">channel </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">createMessage</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;Pong!&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">then</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">            </span><span class="token keyword" style="color:#cc7832">return</span><span class="token plain"> </span><span class="token class-name">Mono</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">when</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">onReady</span><span class="token punctuation" style="color:#a9b7c6">,</span><span class="token plain"> ping</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">}</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">block</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Converting each event listener into a <code>Mono&lt;Void&gt;</code> allows us to wire both together and avoid calling <code>client.onDisconnect()</code>.</p>
<h1>Discord4J features</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-to-the-gateway">Connecting to the Gateway<a href="#connecting-to-the-gateway" class="hash-link" aria-label="Direct link to Connecting to the Gateway" title="Direct link to Connecting to the Gateway">​</a></h2>
<p>We added convenience methods to <code>DiscordClient</code>, namely static <code>DiscordClient.builder(token)</code> and <code>DiscordClient.create(token)</code> to quickly get started.</p>
<p>To connect using the default options:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#a9b7c6;--prism-background-color:#2b2b2b"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#a9b7c6;background-color:#2b2b2b"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#a9b7c6"><span class="token class-name">DiscordClient</span><span class="token plain"> client </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> </span><span class="token class-name">DiscordClient</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">create</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">System</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getenv</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;token&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain"></span><span class="token class-name">GatewayDiscordClient</span><span class="token plain"> gateway </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">login</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">block</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">gateway</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">on</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">ReadyEvent</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token keyword" style="color:#cc7832">class</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">subscribe</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">ready </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">            </span><span class="token class-name">System</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">println</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;Logged in as &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#a9b7c6">+</span><span class="token plain"> ready</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getSelf</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getUsername</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">gateway</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">onDisconnect</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">block</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (4)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>(1) Shortcut to <code>new DiscordClientBuilder(token).build()</code></li>
<li>(2) Acquire a synchronous handle on gateway connections, can be used to register events, get cached entities, etc.</li>
<li>(3) Shortcut to <code>gateway.getEventDispatcher().on(ReadyEvent.class)</code></li>
<li>(4) To keep the <code>main</code> thread alive, await until bot disconnects through <code>logout()</code></li>
</ul>
<p>You can also connect using a traditional <code>flatMap</code> style, but if you&#x27;re going this route we recommend the new <code>withGateway</code> API:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#a9b7c6;--prism-background-color:#2b2b2b"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#a9b7c6;background-color:#2b2b2b"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#a9b7c6"><span class="token class-name">DiscordClient</span><span class="token plain"> client </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> </span><span class="token class-name">DiscordClient</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">create</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">System</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getenv</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;token&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">client</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">withGateway</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">gateway </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#a9b7c6">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token class-name">Flux</span><span class="token generics punctuation" style="color:#a9b7c6">&lt;</span><span class="token generics class-name">ReadyEvent</span><span class="token generics punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain"> hello </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> gateway</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">on</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">ReadyEvent</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token keyword" style="color:#cc7832">class</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">            </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">doOnNext</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">ready </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token class-name">System</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">println</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;Logged in as &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#a9b7c6">+</span><span class="token plain"> ready</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getSelf</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getUsername</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">            </span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token class-name">Flux</span><span class="token generics punctuation" style="color:#a9b7c6">&lt;</span><span class="token generics class-name">MessageCreateEvent</span><span class="token generics punctuation" style="color:#a9b7c6">&gt;</span><span class="token plain"> messages </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> gateway</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">on</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">MessageCreateEvent</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token keyword" style="color:#cc7832">class</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">            </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">doOnNext</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">event </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token class-name">System</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token plain">out</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">println</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;&gt; &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#a9b7c6">+</span><span class="token plain"> event</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getMessage</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getContent</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">            </span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token keyword" style="color:#cc7832">return</span><span class="token plain"> </span><span class="token class-name">Mono</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">when</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">hello</span><span class="token punctuation" style="color:#a9b7c6">,</span><span class="token plain"> messages</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain"></span><span class="token punctuation" style="color:#a9b7c6">}</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">block</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (2)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>(1) Can use <code>Mono.when</code> to await for the completion of multiple sequences</li>
<li>(2) Blocking here establishes the connections and waits until the bot logs out.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="adding-event-listeners">Adding event listeners<a href="#adding-event-listeners" class="hash-link" aria-label="Direct link to Adding event listeners" title="Direct link to Adding event listeners">​</a></h2>
<p>Access to the <code>EventDispatcher</code> is through <code>GatewayDiscordClient</code>. Calling <code>#getEventDispatcher()</code> is optional as shortcut <code>.on(...)</code> methods have been added to it.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#a9b7c6;--prism-background-color:#2b2b2b"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#a9b7c6;background-color:#2b2b2b"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#a9b7c6"><span class="token comment" style="color:#808080">// Alternative 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">gateway</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">on</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">MessageCreateEvent</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token keyword" style="color:#cc7832">class</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">map</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">MessageCreateEvent</span><span class="token operator" style="color:#a9b7c6">::</span><span class="token function" style="color:#ffc66d">getMessage</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">filter</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">msg </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> </span><span class="token class-name">Optional</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">of</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getContent</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">map</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;!ping&quot;</span><span class="token operator" style="color:#a9b7c6">::</span><span class="token function" style="color:#ffc66d">equals</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">orElse</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token boolean" style="color:#cc7832">false</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">flatMap</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">Message</span><span class="token operator" style="color:#a9b7c6">::</span><span class="token function" style="color:#ffc66d">getChannel</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">flatMap</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">channel </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">createMessage</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;Pong!&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">onErrorResume</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">t </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> </span><span class="token class-name">Mono</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">empty</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">subscribe</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain"></span><span class="token comment" style="color:#808080">// Alternative 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">gateway</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">on</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">MessageCreateEvent</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token keyword" style="color:#cc7832">class</span><span class="token punctuation" style="color:#a9b7c6">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        event </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> </span><span class="token class-name">Mono</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">just</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">event</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getMessage</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">filter</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">message </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                    </span><span class="token class-name">Optional</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">of</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">message</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getContent</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">map</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;!ping&quot;</span><span class="token operator" style="color:#a9b7c6">::</span><span class="token function" style="color:#ffc66d">equals</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">orElse</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token boolean" style="color:#cc7832">false</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">flatMap</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">Message</span><span class="token operator" style="color:#a9b7c6">::</span><span class="token function" style="color:#ffc66d">getChannel</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">                </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">flatMap</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">channel </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> channel</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">createMessage</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;Pong!&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">subscribe</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (2)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>(1) Needs error handling code along the chain</li>
<li>(2) Error handling provided for you within the <code>event -&gt; { ... }</code> block</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="customizing-gateway-features">Customizing Gateway features<a href="#customizing-gateway-features" class="hash-link" aria-label="Direct link to Customizing Gateway features" title="Direct link to Customizing Gateway features">​</a></h2>
<p>Discord4J v3.1 introduces a new architecture where a <code>GatewayBootstrap</code> creates a <strong>shard group</strong> that will share events and caches.</p>
<p>Most of the options you would previously set at the <code>DiscordClientBuilder</code> or <code>ShardingClientBuilder</code> level in v3.0, are now located at <code>GatewayBootstrap</code>. This is a builder to establish gateway connections from a <code>DiscordClient</code> by calling <code>gateway()</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-setshardcountn-or-setshardindexi">Migrating from <code>setShardCount(n)</code> or <code>setShardIndex(i)</code><a href="#migrating-from-setshardcountn-or-setshardindexi" class="hash-link" aria-label="Direct link to migrating-from-setshardcountn-or-setshardindexi" title="Direct link to migrating-from-setshardcountn-or-setshardindexi">​</a></h3>
<p>Get a builder with <code>client.gateway()</code> and then call <code>setSharding(ShardingStrategy)</code>. Creating a <code>ShardingStrategy</code> can be done using the following factories:</p>
<ul>
<li><code>ShardingStrategy.recommended()</code> will provide the recommended amount of shards and include all of them in the group</li>
<li><code>ShardingStrategy.fixed(n)</code> will use the given <code>shardCount</code> and include all shards <code>0..N</code> in the group</li>
<li><code>ShardingStrategy.single()</code> will use a simple <code>[0,1]</code> configuration, for small bots and <a href="https://github.com/Discord4J/connect" target="_blank" rel="noopener noreferrer">distributed bot architectures</a></li>
</ul>
<p>You can also customize the strategy using <code>ShardingStrategy.builder()</code> allowing you to configure:</p>
<ul>
<li>Total count of shards parameter through <code>count</code></li>
<li>Shards identified to the Gateway using <code>indices</code></li>
<li>Can be also combined with <code>filter</code> to connect a subset of shards</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-setinitialpresence">Migrating from <code>setInitialPresence</code><a href="#migrating-from-setinitialpresence" class="hash-link" aria-label="Direct link to migrating-from-setinitialpresence" title="Direct link to migrating-from-setinitialpresence">​</a></h3>
<p>Similar to above, call <code>setInitialStatus</code> which now takes a <code>Function&lt;ShardInfo, StatusUpdate&gt;</code>. If you used <code>setInitialPresence(Presence.invisible())</code> you should now use <code>setInitialStatus(shard -&gt; Presence.invisible())</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-setidentifyoptions">Migrating from <code>setIdentifyOptions</code><a href="#migrating-from-setidentifyoptions" class="hash-link" aria-label="Direct link to migrating-from-setidentifyoptions" title="Direct link to migrating-from-setidentifyoptions">​</a></h3>
<p><code>IdentifyOptions</code> cannot be set directly now and you&#x27;ll have to use a mix of <code>setSharding</code> and <code>setResumeOptions</code> depending on your use case.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-setstoreserviceservice">Migrating from <code>setStoreService(service)</code><a href="#migrating-from-setstoreserviceservice" class="hash-link" aria-label="Direct link to migrating-from-setstoreserviceservice" title="Direct link to migrating-from-setstoreserviceservice">​</a></h3>
<p>Get a builder with <code>client.gateway()</code> and then call <code>setStoreService(service)</code>. If you used <code>ShardingClientBuilder</code> before, Discord4J can automatically prepare your <code>StoreService</code> with shard invalidation capabilities.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-seteventprocessor-and-seteventscheduler">Migrating from <code>setEventProcessor</code> and <code>setEventScheduler</code><a href="#migrating-from-seteventprocessor-and-seteventscheduler" class="hash-link" aria-label="Direct link to migrating-from-seteventprocessor-and-seteventscheduler" title="Direct link to migrating-from-seteventprocessor-and-seteventscheduler">​</a></h3>
<p>A new interface <code>EventDispatcher</code> is added to more easily customize both options. There are a few built-in factories:</p>
<ul>
<li><code>EventDispatcher.buffering()</code> that stores all events <strong>until the first subscription</strong>, then events are published to all subscribers as they are received. This is identical to the one used in v3.0.</li>
<li><code>EventDispatcher.withEarliestEvents(int)</code> keeps only the earliest events and the rest are dropped <strong>until the first subscription</strong>, then events are published to all subscribers as they are received.</li>
<li><code>EventDispatcher.withLatestEvents(int)</code> keeps only the latest events <strong>until the first subscription</strong>, then events are published to all subscribers as they are received. Initial events like <code>ReadyEvent</code> might be dropped.</li>
<li><code>EventDispatcher.replayingWithTimeout(Duration)</code> that buffers and replays all events up to <code>Duration</code> maximum age.</li>
<li><code>EventDispatcher.replayingWithSize(int)</code> that buffers and replays the latest events.</li>
</ul>
<p>To customize the above options, get a builder with <code>client.gateway()</code> and then call <code>setEventDispatcher(...)</code>.</p>
<p>The current default is a <code>ReplayingEventDispatcher</code>, created using <code>ReplayingEventDispatcher.create()</code>. It can be customized through <code>ReplayingEventDispatcher.builder()</code> and it works in the following way:</p>
<ul>
<li>Buffers all events before a subscription exists, as long as they match a filter. By default, <code>GatewayLifecycleEvent</code> and <code>GuildCreateEvent</code> types. This can be customized through <code>replayEventFilter</code>.</li>
<li>Early subscribers get all previously buffered events, until a given timeout. By default, 5 seconds after the first subscriber arrives and can be changed in <code>stopReplayingTrigger</code>.</li>
<li>Late subscribers only get events as they are published, no replay capabilities until all subscribers are disposed.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-setgatewayclientfactory">Migrating from <code>setGatewayClientFactory</code><a href="#migrating-from-setgatewayclientfactory" class="hash-link" aria-label="Direct link to migrating-from-setgatewayclientfactory" title="Direct link to migrating-from-setgatewayclientfactory">​</a></h3>
<p>Use <code>login(Function)</code> overload after calling <code>client.gateway()</code>. Used to build distributed bot architectures.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-setretryoptions">Migrating from <code>setRetryOptions</code><a href="#migrating-from-setretryoptions" class="hash-link" aria-label="Direct link to migrating-from-setretryoptions" title="Direct link to migrating-from-setretryoptions">​</a></h3>
<p>Use <code>setReconnectOptions</code> after calling <code>client.gateway()</code>. By default, Discord4J will always attempt to reconnect using an exponential backoff with jitter strategy.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-setgatewayobserver">Migrating from <code>setGatewayObserver</code><a href="#migrating-from-setgatewayobserver" class="hash-link" aria-label="Direct link to migrating-from-setgatewayobserver" title="Direct link to migrating-from-setgatewayobserver">​</a></h3>
<p>Use <code>setGatewayObserver</code> after calling <code>client.gateway()</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-setidentifylimiter">Migrating from <code>setIdentifyLimiter</code><a href="#migrating-from-setidentifylimiter" class="hash-link" aria-label="Direct link to migrating-from-setidentifylimiter" title="Direct link to migrating-from-setidentifylimiter">​</a></h3>
<p>Discord4J v3.1 introduced a new API called <code>ShardCoordinator</code> which groups all options related to coordinating multiple shard identification. We supply <code>LocalShardCoordinator</code> by default and can be replaced by one capable of working with a distributed bot architecture.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="migrating-from-setvoiceconnectionscheduler">Migrating from <code>setVoiceConnectionScheduler</code><a href="#migrating-from-setvoiceconnectionscheduler" class="hash-link" aria-label="Direct link to migrating-from-setvoiceconnectionscheduler" title="Direct link to migrating-from-setvoiceconnectionscheduler">​</a></h3>
<p>Use <code>setVoiceReactorResources</code> after calling <code>client.gateway()</code>. It takes a <code>ReactorResource</code> object that will replace the one set at the <code>DiscordClientBuilder</code> level only for voice. A similar override exists for gateway in <code>setGatewayReactorResources</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="gateway-options">Gateway options<a href="#gateway-options" class="hash-link" aria-label="Direct link to Gateway options" title="Direct link to Gateway options">​</a></h3>
<p>Gateway options are set in <code>GatewayBootstrap</code>. You can obtain one by calling <code>gateway()</code> from <code>DiscordClient</code>.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#a9b7c6;--prism-background-color:#2b2b2b"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#a9b7c6;background-color:#2b2b2b"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#a9b7c6"><span class="token class-name">DiscordClient</span><span class="token plain"> client </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> </span><span class="token class-name">DiscordClient</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">create</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">token</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain"></span><span class="token class-name">GatewayDiscordClient</span><span class="token plain"> gateway </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">gateway</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setInitialStatus</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">shard </span><span class="token operator" style="color:#a9b7c6">-&gt;</span><span class="token plain"> </span><span class="token class-name">Presence</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">online</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setSharding</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">ShardingStrategy</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">recommended</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setShardCoordinator</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">LocalShardCoordinator</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">create</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setAwaitConnections</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token boolean" style="color:#cc7832">true</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (4)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setStoreService</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token keyword" style="color:#cc7832">new</span><span class="token plain"> </span><span class="token class-name">JdkStoreService</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (5)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setEventDispatcher</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">EventDispatcher</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">buffering</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (6)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">login</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">block</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>(1) Set the initial presence depending on the shard.</li>
<li>(2) Sharding policy used by this shard group builder.</li>
<li>(3) Allows coordinating shard login across multiple instances.</li>
<li>(4) Configures how to obtain a <code>GatewayDiscordClient</code>: if <code>false</code>, once the connection process begins (at least 1 shard connects, this is the default) or if <code>true</code>, await until all shards have connected.</li>
<li>(5) Configure the backing store.</li>
<li>(6) Configure the event dispatcher model.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="customizing-rest-features">Customizing REST features<a href="#customizing-rest-features" class="hash-link" aria-label="Direct link to Customizing REST features" title="Direct link to Customizing REST features">​</a></h2>
<p>Core options for REST operations are set at <code>DiscordClientBuilder</code> before building a <code>DiscordClient</code>, similar to v3.0. These core resources can later by retrieved through <code>DiscordClient::getCoreResources()</code> or <code>GatewayDiscordClient::getCoreResources()</code> methods.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#a9b7c6;--prism-background-color:#2b2b2b"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#a9b7c6;background-color:#2b2b2b"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#a9b7c6"><span class="token class-name">JacksonResources</span><span class="token plain"> jackson </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> </span><span class="token keyword" style="color:#cc7832">new</span><span class="token plain"> </span><span class="token class-name">JacksonResources</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain"></span><span class="token class-name">DiscordClient</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">builder</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">System</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">getenv</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token string" style="color:#6a8759">&quot;token&quot;</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setJacksonResources</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">jackson</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setGlobalRateLimiter</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">BucketGlobalRateLimiter</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">create</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (3)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setExchangeStrategies</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">ExchangeStrategies</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">jackson</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token plain">jackson</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (4)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setReactorResources</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">ReactorResources</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">create</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (5)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">onClientResponse</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">ResponseFunction</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">emptyIfNotFound</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (6)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">build</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">gateway</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">login</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">onDisconnect</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">    </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">block</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>(1) Make sure you begin with obtaining a builder.</li>
<li>(2) Can customize how the Jackson object mapper works.</li>
<li>(3) Can customize how the global rate limiter works.</li>
<li>(4) Can customize how are REST requests written and REST responses read.</li>
<li>(5) Can customize the underlying HttpClient used and the threading model</li>
<li>(6) Can customize how the REST client handles response codes under given scenarios.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="requesting-discord-entities">Requesting Discord entities<a href="#requesting-discord-entities" class="hash-link" aria-label="Direct link to Requesting Discord entities" title="Direct link to Requesting Discord entities">​</a></h2>
<p>Starting from v3.1, Discord4J allows you to access <strong>REST entities</strong>, which identifies a given Discord entity in terms of their key parameters, without querying the REST API until you require access to the data they represent. This is expressed across two kinds of classes:</p>
<ul>
<li><code>RestEntity</code> classes provide a way to query the REST API for a specific entity. They are located in the <code>discord4j.rest.entity</code> package.</li>
<li><code>EntityData</code> classes represent a JSON response encapsulated in an immutable object. They are located in the <code>discord4j.discordjson.json</code> package.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-rest-entities">Creating REST entities<a href="#creating-rest-entities" class="hash-link" aria-label="Direct link to Creating REST entities" title="Direct link to Creating REST entities">​</a></h4>
<p>Here are the multiple locations you can get a REST entity from:</p>
<ul>
<li>Replace &quot;Entity&quot; in the following examples with the one you&#x27;re looking for: Channel, Emoji, Guild, Invite, Member, Message, Role, User, Webhook.</li>
<li>Any of the <code>getEntityById()</code> methods in <code>DiscordClient</code> or <code>GatewayDiscordClient::rest()</code> and you&#x27;ll get a <code>RestEntity</code> class</li>
<li>Create them directly by ID: <code>RestEntity.create(123456789012345L)</code></li>
</ul>
<p>The classes available are: <code>RestChannel</code>, <code>RestEmoji</code>, <code>RestGuild</code>, <code>RestInvite</code>, <code>RestMember</code>, <code>RestMessage</code>, <code>RestRole</code>, <code>RestUser</code> and <code>RestWebhook</code></p>
<p>To retrieve these objects you should call methods in <code>DiscordClient</code>, obtained from calling <code>getClient().rest()</code> from most library objects, like <code>Event</code> and <code>Entity</code> instances.</p>
<p>Once you acquire one of these objects, you can perform API methods without querying the contents. Alternative, you can perform an API request to get its content through <code>getData()</code> and will return a <code>Mono&lt;EntityData&gt;</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fetching-entities">Fetching entities<a href="#fetching-entities" class="hash-link" aria-label="Direct link to Fetching entities" title="Direct link to Fetching entities">​</a></h3>
<p>To obtain cached entities you can use the same methods as in v3.0: <code>getEntityById(Snowflake)</code> from within <code>GatewayDiscordClient</code>. These methods will fallback to a REST API request if they are not found in cache.</p>
<p>Starting from v3.1 you can customize how these entities are fetched, using the <strong>EntityRetrievalStrategy</strong>. This is configured when bootstrapping a Gateway group:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#a9b7c6;--prism-background-color:#2b2b2b"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#a9b7c6;background-color:#2b2b2b"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#a9b7c6"><span class="token class-name">GatewayDiscordClient</span><span class="token plain"> gateway </span><span class="token operator" style="color:#a9b7c6">=</span><span class="token plain"> discordClient</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">gateway</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">setEntityRetrievalStrategy</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token class-name">EntityRetrievalStrategy</span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token constant" style="color:#9876aa">STORE</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"> </span><span class="token comment" style="color:#808080">// (1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">login</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#a9b7c6"><span class="token plain">        </span><span class="token punctuation" style="color:#a9b7c6">.</span><span class="token function" style="color:#ffc66d">block</span><span class="token punctuation" style="color:#a9b7c6">(</span><span class="token punctuation" style="color:#a9b7c6">)</span><span class="token punctuation" style="color:#a9b7c6">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>(1) Only retrieve entities from store by default</li>
</ul>
<p>The following strategies are available:</p>
<ul>
<li><code>EntityRetrievalStrategy.STORE</code> to only fetch from the Store (cache) and therefore return empty if a request entity is missing.</li>
<li><code>EntityRetrievalStrategy.REST</code> to fetch from REST directly, without attempting to hit the Store.</li>
<li><code>EntityRetrievalStrategy.STORE_FALLBACK_REST</code> to use the default setting from v3.0, which is attempting to hit the Store and if it&#x27;s missed, fall back to a REST API call.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="logging">Logging<a href="#logging" class="hash-link" aria-label="Direct link to Logging" title="Direct link to Logging">​</a></h2>
<p>Logger structure has changed for v3.1, adding contextual information regarding gateway ID, shard ID, request bucket and request ID. For more details about the available loggers in this version, check our <a href="/logging">Logging</a> page.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="advanced-features">Advanced features<a href="#advanced-features" class="hash-link" aria-label="Direct link to Advanced features" title="Direct link to Advanced features">​</a></h2>
<p>For more detailed list of changes and migration notes, please check <a href="/whats-new-in-v3-1">What&#x27;s new in v3.1</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Discord4J/documentation/edit/master/docs/07-Migration Guides/migrating-from-v3-0-to-v3-1.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2024-05-04T21:02:29.000Z" itemprop="dateModified">May 4, 2024</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/migrating-from-v2-x-to-v3-1"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Migrating from v2.x to v3.1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/migrating-from-v3-1-to-v3-2"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Migrating from v3.1 to v3.2</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#before-you-start" class="table-of-contents__link toc-highlight">Before you start</a></li><li><a href="#updating-dependencies" class="table-of-contents__link toc-highlight">Updating dependencies</a><ul><li><a href="#gradle" class="table-of-contents__link toc-highlight">Gradle</a></li><li><a href="#maven" class="table-of-contents__link toc-highlight">Maven</a></li></ul></li><li><a href="#connecting-to-the-gateway" class="table-of-contents__link toc-highlight">Connecting to the Gateway</a></li><li><a href="#adding-event-listeners" class="table-of-contents__link toc-highlight">Adding event listeners</a></li><li><a href="#customizing-gateway-features" class="table-of-contents__link toc-highlight">Customizing Gateway features</a><ul><li><a href="#migrating-from-setshardcountn-or-setshardindexi" class="table-of-contents__link toc-highlight">Migrating from <code>setShardCount(n)</code> or <code>setShardIndex(i)</code></a></li><li><a href="#migrating-from-setinitialpresence" class="table-of-contents__link toc-highlight">Migrating from <code>setInitialPresence</code></a></li><li><a href="#migrating-from-setidentifyoptions" class="table-of-contents__link toc-highlight">Migrating from <code>setIdentifyOptions</code></a></li><li><a href="#migrating-from-setstoreserviceservice" class="table-of-contents__link toc-highlight">Migrating from <code>setStoreService(service)</code></a></li><li><a href="#migrating-from-seteventprocessor-and-seteventscheduler" class="table-of-contents__link toc-highlight">Migrating from <code>setEventProcessor</code> and <code>setEventScheduler</code></a></li><li><a href="#migrating-from-setgatewayclientfactory" class="table-of-contents__link toc-highlight">Migrating from <code>setGatewayClientFactory</code></a></li><li><a href="#migrating-from-setretryoptions" class="table-of-contents__link toc-highlight">Migrating from <code>setRetryOptions</code></a></li><li><a href="#migrating-from-setgatewayobserver" class="table-of-contents__link toc-highlight">Migrating from <code>setGatewayObserver</code></a></li><li><a href="#migrating-from-setidentifylimiter" class="table-of-contents__link toc-highlight">Migrating from <code>setIdentifyLimiter</code></a></li><li><a href="#migrating-from-setvoiceconnectionscheduler" class="table-of-contents__link toc-highlight">Migrating from <code>setVoiceConnectionScheduler</code></a></li><li><a href="#gateway-options" class="table-of-contents__link toc-highlight">Gateway options</a></li></ul></li><li><a href="#customizing-rest-features" class="table-of-contents__link toc-highlight">Customizing REST features</a></li><li><a href="#requesting-discord-entities" class="table-of-contents__link toc-highlight">Requesting Discord entities</a><ul><li><a href="#fetching-entities" class="table-of-contents__link toc-highlight">Fetching entities</a></li></ul></li><li><a href="#logging" class="table-of-contents__link toc-highlight">Logging</a></li><li><a href="#advanced-features" class="table-of-contents__link toc-highlight">Advanced features</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Discord4J Docs</a></li><li class="footer__item"><a href="https://javadoc.io/doc/com.discord4j/discord4j-core" target="_blank" rel="noopener noreferrer" class="footer__link-item">Javadocs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Discord4J/Discord4J" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://projectreactor.io/docs/core/release/reference/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reactor Reference Guide<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.com/developers/docs/intro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/d4j" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
              <a href="https://www.netlify.com">
                <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify">
              </a>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2015 - 2024 Discord4J - Licensed under LGPLv3.</div></div></div></footer></div>
</body>
</html>