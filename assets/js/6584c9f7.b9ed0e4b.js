"use strict";(self.webpackChunkdiscord4j_documentation=self.webpackChunkdiscord4j_documentation||[]).push([[181],{4368:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>d});var t=i(4848),r=i(8453);const a={id:"music-bot-tutorial",title:"Music Bot Tutorial",sidebar_label:"Music Bot Tutorial",slug:"/music-bot-tutorial"},s=void 0,o={id:"Tutorials/music-bot-tutorial",title:"Music Bot Tutorial",description:"This tutorial is not yet migrated to Diataxis framework and might be out of date as it was updated for Discord4J v3.1.x.",source:"@site/docs/03-Tutorials/03-music-bot-tutorial.mdx",sourceDirName:"03-Tutorials",slug:"/music-bot-tutorial",permalink:"/music-bot-tutorial",draft:!1,unlisted:!1,editUrl:"https://github.com/Discord4J/documentation/edit/master/docs/03-Tutorials/03-music-bot-tutorial.mdx",tags:[],version:"current",lastUpdatedAt:163501066e4,sidebarPosition:3,frontMatter:{id:"music-bot-tutorial",title:"Music Bot Tutorial",sidebar_label:"Music Bot Tutorial",slug:"/music-bot-tutorial"},sidebar:"mySidebar",previous:{title:"Basic Bot Tutorial",permalink:"/basic-bot-tutorial"},next:{title:"Application Commands",permalink:"/interactions/application-commands"}},l={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Setting Up IntelliJ",id:"setting-up-intellij",level:3},{value:"Step 1",id:"step-1",level:4},{value:"Step 2",id:"step-2",level:4},{value:"Step 3",id:"step-3",level:4},{value:"Step 4",id:"step-4",level:4},{value:"Step 5",id:"step-5",level:4},{value:"Step 6",id:"step-6",level:4},{value:"Step 7",id:"step-7",level:4},{value:"Creating a Bot",id:"creating-a-bot",level:3},{value:"Step 8",id:"step-8",level:4},{value:"Step 9",id:"step-9",level:4},{value:"Step 10",id:"step-10",level:4},{value:"Step 11",id:"step-11",level:4},{value:"Step 12",id:"step-12",level:4},{value:"Using Discord4J v3.0.x",id:"using-discord4j-v30x",level:6},{value:"Using Discord4J v3.1.x and above",id:"using-discord4j-v31x-and-above",level:6},{value:"Step 13",id:"step-13",level:4},{value:"Step 14",id:"step-14",level:4},{value:"Step 15",id:"step-15",level:4},{value:"Step 16",id:"step-16",level:4},{value:"Adding Commands",id:"adding-commands",level:3},{value:"Code Notice",id:"code-notice",level:4},{value:"Step 17",id:"step-17",level:4},{value:"Imperative Approach",id:"imperative-approach",level:6},{value:"Reactive Approach",id:"reactive-approach",level:6},{value:"Step 18",id:"step-18",level:4},{value:"Step 19",id:"step-19",level:4},{value:"Imperative Approach",id:"imperative-approach-1",level:6},{value:"Reactive Approach",id:"reactive-approach-1",level:6},{value:"Step 20",id:"step-20",level:4},{value:"Discord4J 3.0.x - Imperative Approach",id:"discord4j-30x---imperative-approach",level:6},{value:"Discord4J 3.0.x - Reactive Approach",id:"discord4j-30x---reactive-approach",level:6},{value:"Discord4J 3.1.x - Imperative Approach",id:"discord4j-31x---imperative-approach",level:6},{value:"Discord4J 3.1.x - Reactive Approach",id:"discord4j-31x---reactive-approach",level:6},{value:"Step 21",id:"step-21",level:4},{value:"Adding Music",id:"adding-music",level:3},{value:"Step 22",id:"step-22",level:4},{value:"Step 23",id:"step-23",level:4},{value:"Step 24",id:"step-24",level:4},{value:"Step 25",id:"step-25",level:4},{value:"Imperative Approach",id:"imperative-approach-2",level:6},{value:"Reactive Approach",id:"reactive-approach-2",level:6},{value:"Step 26",id:"step-26",level:4},{value:"Step 27",id:"step-27",level:4},{value:"Imperative Approach",id:"imperative-approach-3",level:6},{value:"Reactive Approach",id:"reactive-approach-3",level:6},{value:"Step 28",id:"step-28",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",h6:"h6",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsx)(n.p,{children:"This tutorial is not yet migrated to Diataxis framework and might be out of date as it was updated for Discord4J v3.1.x."}),(0,t.jsxs)(n.p,{children:["Feel free to suggest changes to it in our ",(0,t.jsx)(n.a,{href:"https://discord.gg/d4j",children:"Discord Server"})," or through a ",(0,t.jsx)(n.a,{href:"https://github.com/Discord4J/Discord4J/issues/new/choose",children:"GitHub issue"})," if you encounter issues while following it."]})]}),"\n",(0,t.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsxs)(n.p,{children:["One of the most common, and almost necessary, features for any Discord bot is the ability to playback music. This tutorial will provide an in-depth guide on how to create a music bot from scratch using Discord4J (and ",(0,t.jsx)(n.a,{href:"https://github.com/sedmelluq/lavaplayer",children:"LavaPlayer"}),")."]}),"\n",(0,t.jsx)(n.p,{children:"Discord4J facilitates an environment where a Discord bot can be programmed in two different ways, reactively and/or imperatively. Reactive programming, while more efficient, is a paradigm shift from the traditional imperative Java programming model. This tutorial will provide both reactive and imperative approaches to designing a music bot for users who desire to implement either paradigm."}),"\n",(0,t.jsx)(n.p,{children:"It is expected to complete this tutorial in under 15 minutes."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsx)(n.tr,{children:(0,t.jsx)(n.th,{children:"Table of Contents"})})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsx)(n.tr,{children:(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#introduction",children:"Introduction"})})}),(0,t.jsx)(n.tr,{children:(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#requirements",children:"Requirements"})})}),(0,t.jsx)(n.tr,{children:(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#setting-up-intellij",children:"Setting Up IntelliJ"})})}),(0,t.jsx)(n.tr,{children:(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#creating-a-bot",children:"Creating a Bot"})})}),(0,t.jsx)(n.tr,{children:(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#adding-commands",children:"Adding Commands"})})}),(0,t.jsx)(n.tr,{children:(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"#adding-music",children:"Adding Music"})})})]})]}),"\n",(0,t.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["You should already have your bot created and its token ready for use. If you do not, go to this ",(0,t.jsx)(n.a,{href:"https://discord.com/developers/applications/",children:"link"}),", create an application, obtain the bot token, and the Client ID."]}),"\n",(0,t.jsx)(n.li,{children:"JDK 8 or above should already be downloaded and/or installed on your system."}),"\n",(0,t.jsxs)(n.li,{children:["This tutorial assumes you are familiar with Java 8 or above concepts with a special emphasis in lambdas. If you are unfamiliar with lambdas, please visit our ",(0,t.jsx)(n.a,{href:"/lambda-tutorial",children:"Lambda Tutorial"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["This tutorial uses ",(0,t.jsx)(n.a,{href:"https://www.jetbrains.com/idea/",children:"IntelliJ"})," to set up the programming environment and it is assumed to already be installed on your system. Eclipse, Netbeans, and other IDEs have similar, but slightly different, setup processes. Please consult the documentation for your specific IDE as it is necessary."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"setting-up-intellij",children:"Setting Up IntelliJ"}),"\n",(0,t.jsx)(n.p,{children:"Before coding, we need to create and setup a project with Discord4J installed. This section will cover what Maven is, how to create a Maven project using IntelliJ, and how to use Maven to install Discord4J."}),"\n",(0,t.jsx)(n.h4,{id:"step-1",children:"Step 1"}),"\n",(0,t.jsxs)(n.p,{children:["Open IntelliJ and select ",(0,t.jsx)(n.strong,{children:"Create New Project"}),"."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_create_project.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-2",children:"Step 2"}),"\n",(0,t.jsxs)(n.p,{children:["Select ",(0,t.jsx)(n.strong,{children:"Maven"}),". ",(0,t.jsx)(n.a,{href:"https://maven.apache.org/",children:"Maven"})," is a software project management and comprehension tool. Alongside its main competitor ",(0,t.jsx)(n.a,{href:"https://gradle.org/",children:"Gradle"}),", Maven is practically required and essential for all Java development projects both personal and professional. It is what will enable us to install Discord4J and its dependencies along with any other dependencies and dependencies of those dependencies easily and with minimal effort."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_create_project_maven.png"}),"\n",(0,t.jsxs)(n.p,{children:["\u26a0\ufe0f If ",(0,t.jsx)(n.em,{children:"Project SDK"})," is blank, click ",(0,t.jsx)(n.strong,{children:"New"})," and navigate to a directory where a JDK is present and click ",(0,t.jsx)(n.strong,{children:"OK"}),"."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_project_sdk.png"}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_project_sdk_select.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-3",children:"Step 3"}),"\n",(0,t.jsxs)(n.p,{children:["Click ",(0,t.jsx)(n.strong,{children:"Next"}),", and you'll be required to provide a ",(0,t.jsx)(n.em,{children:"GroupId"}),", ",(0,t.jsx)(n.em,{children:"ArtifactId"}),", and ",(0,t.jsx)(n.em,{children:"Version"}),". Refer to this ",(0,t.jsx)(n.a,{href:"https://maven.apache.org/guides/mini/guide-naming-conventions.html",children:"link"})," for a detailed explanation of each of these attributes. After you are done providing your attributes, select ",(0,t.jsx)(n.strong,{children:"Next"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["I will be using the reverse domain name of GitHub as my ",(0,t.jsx)(n.em,{children:"GroupId"})," with an addition of my username and the name of the project (DMusic, for Discord Music). The ",(0,t.jsx)(n.em,{children:"ArtifactId"}),' will be "dmusic" as I expect an outputted jar to be referred to as "dmusic.jar". Finally, as for the ',(0,t.jsx)(n.em,{children:"Version"}),", since this is an application, not a library, I prefer using a date-based versioning scheme, particularly ",(0,t.jsx)(n.code,{children:"YEAR.MONTH.DAY"}),"."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_project_version.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-4",children:"Step 4"}),"\n",(0,t.jsxs)(n.p,{children:["This page will ask for a ",(0,t.jsx)(n.em,{children:"Project Name"}),". You may leave it as the default (it automatically takes from the ",(0,t.jsx)(n.em,{children:"ArtifactId"}),"), but I personally prefer having proper capitalization when working in IntelliJ. After you have chosen, select ",(0,t.jsx)(n.strong,{children:"Finish"}),"."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_project_name.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-5",children:"Step 5"}),"\n",(0,t.jsxs)(n.p,{children:["Once IntelliJ has created the project, a dialog box will appear in the bottom-right corner. Select ",(0,t.jsx)(n.strong,{children:"Enable Auto-Import"}),". This will have IntelliJ automatically install dependencies like Discord4J after we request for them, rather than needing to manually refresh the project."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_maven_auto_import.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-6",children:"Step 6"}),"\n",(0,t.jsxs)(n.p,{children:["IntelliJ will automatically open the ",(0,t.jsx)(n.em,{children:"pom.xml"})," after it has created the project. Maven uses the ",(0,t.jsx)(n.em,{children:"pom.xml"})," to control the project's structure, and it's how we will be telling Maven to install Discord4J. As you can see ",(0,t.jsx)(n.a,{href:"/quickstart",children:"here"}),', Discord4J provides a set of "coordinates" that tells Maven how to find Discord4J. You may have noticed these coordinates contain a ',(0,t.jsx)(n.em,{children:"GroupId"}),", ",(0,t.jsx)(n.em,{children:"ArtifactId"}),", and ",(0,t.jsx)(n.em,{children:"Version"}),"; just like the attributes we have provided earlier! The coordinates are how Maven uniquely identifies a project, picks out a specific version, finds it, and eventually installs it for us."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Add"})," the coordinates to the root of the ",(0,t.jsx)(n.em,{children:"pom.xml"}),". If the text is red, that is OK! Give IntelliJ and Maven a few seconds or a minute to download and add Discord4J to our project. The text will eventually turn completely white."]}),"\n",(0,t.jsx)(n.p,{children:"Important: Version numbers shown in these images might be outdated. While following this tutorial, prefer using the latest version in the 3.1.x line:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://search.maven.org/artifact/com.discord4j/discord4j-core",children:(0,t.jsx)(n.img,{src:"https://img.shields.io/maven-central/v/com.discord4j/discord4j-core/3.1.svg?style=flat-square",alt:"Maven Central"})})}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_maven_versionnum.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-7",children:"Step 7"}),"\n",(0,t.jsxs)(n.p,{children:["Under ",(0,t.jsx)(n.strong,{children:"External Libraries"})," on the navigation pane, ",(0,t.jsx)(n.code,{children:"discord4j-core"})," should be present. This means Discord4J has been properly imported, and we are ready to utilize it in our project!"]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_maven_external_libraries.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"creating-a-bot",children:"Creating a Bot"}),"\n",(0,t.jsx)(n.p,{children:"Once IntelliJ is configured for Maven with Discord4J installed we can finally start coding! This section will cover how to make your bot appear online once you start the program."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-8",children:"Step 8"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Right click"})," on ",(0,t.jsx)(n.strong,{children:"src/main/java"})," in the ",(0,t.jsx)(n.em,{children:"Project View"})," and ",(0,t.jsx)(n.strong,{children:"select"})," the ",(0,t.jsx)(n.strong,{children:"New -> Package"})," option. This will allow us to create a base package for us to work with and acts as a starting point to help organize our code."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_create_package.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-9",children:"Step 9"}),"\n",(0,t.jsxs)(n.p,{children:["You should choose a package structure equal to the ",(0,t.jsx)(n.em,{children:"GroupId"})," that you provided back in Step 3."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_package_name.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-10",children:"Step 10"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Right click"})," on the last folder of your package structure and ",(0,t.jsx)(n.strong,{children:"select"})," the ",(0,t.jsx)(n.strong,{children:"New -> Java Class"})," option. We will now refer to this specific folder as the ",(0,t.jsx)(n.em,{children:"root package"}),". For example, ",(0,t.jsx)(n.code,{children:"dmusic"})," for my project is considered the ",(0,t.jsx)(n.em,{children:"root package"}),"."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_create_java_class.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-11",children:"Step 11"}),"\n",(0,t.jsx)(n.p,{children:"Choose a class name. It will contain our main method and as a personal preference I like having such classes equal the name of my application."}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_class_name.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-12",children:"Step 12"}),"\n",(0,t.jsxs)(n.p,{children:["Create a main method and add the code below. Assume ",(0,t.jsx)(n.code,{children:"args"})," refers to the String array that is standard on all main methods, i.e., ",(0,t.jsx)(n.code,{children:"String[] args"}),"."]}),"\n",(0,t.jsx)(n.h6,{id:"using-discord4j-v30x",children:"Using Discord4J v3.0.x"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"final DiscordClient client = new DiscordClientBuilder(args[0]).build();\r\nclient.login().block();\n"})}),"\n",(0,t.jsxs)(n.p,{children:["What is happening here? Well in order to make our bot appear online it has to ",(0,t.jsx)(n.em,{children:"login"}),". The ability to ",(0,t.jsx)(n.em,{children:"login"})," is only applicable to an instance of ",(0,t.jsx)(n.code,{children:"DiscordClient"})," and the only way to obtain a ",(0,t.jsx)(n.code,{children:"DiscordClient"})," instance is to build it using ",(0,t.jsx)(n.code,{children:"DiscordClientBuilder"}),". We first build ",(0,t.jsx)(n.code,{children:"DiscordClientBuilder"})," using ",(0,t.jsx)(n.code,{children:"args[0]"})," which will take the first argument of our program which we will use to pass our bot token. Since we are not interested in any other options from ",(0,t.jsx)(n.code,{children:"DiscordClientBuilder"})," we can just simply build a ",(0,t.jsx)(n.code,{children:"DiscordClient"})," by calling ",(0,t.jsx)(n.code,{children:"build"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Once we have our ",(0,t.jsx)(n.code,{children:"DiscordClient"})," instance we now call ",(0,t.jsx)(n.code,{children:"login"}),". However, ",(0,t.jsx)(n.code,{children:"login"})," returns a type called a ",(0,t.jsx)(n.code,{children:"Mono"}),", which is an ",(0,t.jsx)(n.em,{children:"asynchronous"})," and ",(0,t.jsx)(n.em,{children:"lazy"})," data type. It doesn't ",(0,t.jsx)(n.em,{children:"do"})," anything until we ",(0,t.jsx)(n.em,{children:"request"})," it to do so and the ability to ",(0,t.jsx)(n.em,{children:"request"})," an action can be accomplished in numerous ways. For now, we will call ",(0,t.jsx)(n.code,{children:"block"}),' which essentially means "request this action and wait (',(0,t.jsx)(n.em,{children:"block"}),'ing the current thread) for it to finish".']}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"v3.0 behavior:"})," ",(0,t.jsx)(n.code,{children:"login"}),' will not "finish" until the bot is completely disconnected, i.e., calling ',(0,t.jsx)(n.code,{children:"logout"})," at some point in the future."]}),"\n",(0,t.jsx)(n.h6,{id:"using-discord4j-v31x-and-above",children:"Using Discord4J v3.1.x and above"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"final GatewayDiscordClient client = DiscordClientBuilder.create(args[0]).build()\r\n    .login()\r\n    .block();\r\nclient.onDisconnect().block();\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"v3.1 behavior:"})," ",(0,t.jsx)(n.code,{children:"login"}),' will not "finish" until the bot has ',(0,t.jsx)(n.strong,{children:"connected to the Gateway"})," and will return a ",(0,t.jsx)(n.code,{children:"GatewayDiscordClient"})," object that can be used to operate on the Discord real-time websocket for bots."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-13",children:"Step 13"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Click"})," on the ",(0,t.jsx)(n.strong,{children:"green arrow"})," next to the ",(0,t.jsx)(n.strong,{children:"main"})," method and ",(0,t.jsx)(n.strong,{children:"select"})," the ",(0,t.jsx)(n.strong,{children:"Run"})," option."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_run.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-14",children:"Step 14"}),"\n",(0,t.jsxs)(n.p,{children:["After IntelliJ compiles your program and starts, you'll immediately encounter an ",(0,t.jsx)(n.code,{children:"ArrayIndexOutOfBoundsException"}),". This is because we haven't provided any arguments for our program yet so ",(0,t.jsx)(n.code,{children:"args[0]"})," is invalid! So let's fix that. In the ",(0,t.jsx)(n.strong,{children:"top right"})," corner go into the ",(0,t.jsx)(n.strong,{children:"Edit Configurations..."})," menu."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_edit_configurations.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-15",children:"Step 15"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Add"})," your bot token to ",(0,t.jsx)(n.em,{children:"Program arguments"})," and click ",(0,t.jsx)(n.strong,{children:"Apply"})," then ",(0,t.jsx)(n.strong,{children:"OK"}),"."]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_program_arguments.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-16",children:"Step 16"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Rerun"})," the program, you should now see a bunch of output to the console. Congratulations, your bot is now online! If you invite your bot using the link below, replacing ",(0,t.jsx)(n.code,{children:"CLIENTID"})," with the Client ID, then you will see your bot green and ready. If you wish to disconnect your bot, ",(0,t.jsx)(n.strong,{children:"click"})," on the ",(0,t.jsx)(n.strong,{children:"Exit"})," button in the console."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"https://discord.com/oauth2/authorize?client_id=CLIENTID&scope=bot"})}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_console.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"adding-commands",children:"Adding Commands"}),"\n",(0,t.jsx)(n.p,{children:"Once the bot appears online we should allow it to respond to certain input from users. This section will cover one of the many ways to implement commands, or specifically structured user input, to allow responses from our bot."}),"\n",(0,t.jsx)(n.h4,{id:"code-notice",children:"Code Notice"}),"\n",(0,t.jsxs)(n.p,{children:["The next two sections will feature a lot more code than visual guidelines as seen from the previous sections. Each step will go in-depth about what the code ",(0,t.jsx)(n.em,{children:"does"})," and ",(0,t.jsx)(n.em,{children:"why"})," the code is written, but it will not step line-by-line to explain every minute detail."]}),"\n",(0,t.jsxs)(n.p,{children:["As outlined by the introduction, this tutorial will focus on two paradigms of programming that Discord4J supports, reactively and imperatively. Do ",(0,t.jsx)(n.strong,{children:"NOT"})," implement both paradigms; only implement one. Both paradigms are provided by this tutorial to demonstrate how the two can be translated for easier understanding which is especially important when learning reactive programming."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-17",children:"Step 17"}),"\n",(0,t.jsx)(n.p,{children:"There are many approaches to implementing a command system that have different trade-offs in abstraction, ease-of-use, ease-of-implementation, etc. In this tutorial we will be implementing a map-based, interface-bound command system. It is not the best solution, but you will have a functioning command system up and running very quickly, and it is very simple to understand."}),"\n",(0,t.jsxs)(n.p,{children:["First, ",(0,t.jsx)(n.strong,{children:"create"})," an ",(0,t.jsx)(n.strong,{children:"interface"})," named ",(0,t.jsx)(n.code,{children:"Command"})," with a ",(0,t.jsx)(n.strong,{children:"single method"})," that accepts a ",(0,t.jsx)(n.code,{children:"MessageCreateEvent"}),'. As the name suggest, this event is fired whenever a message is created. We will be using this interface to represent any given "command", i.e., ',(0,t.jsx)(n.code,{children:"execute"})," will only fire if we received the particular command that the implementation represents."]}),"\n",(0,t.jsx)(n.h6,{id:"imperative-approach",children:"Imperative Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"interface Command {\r\n    void execute(MessageCreateEvent event);\r\n}\n"})}),"\n",(0,t.jsx)(n.h6,{id:"reactive-approach",children:"Reactive Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"interface Command {\r\n    // Since we are expecting to do reactive things in this method, like\r\n    // send a message, then this method will also return a reactive type.\r\n    Mono<Void> execute(MessageCreateEvent event);\r\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-18",children:"Step 18"}),"\n",(0,t.jsxs)(n.p,{children:["Next, we need a way to have all our commands in one place, so we can choose which one we want to fire for any given ",(0,t.jsx)(n.code,{children:"MessageCreateEvent"}),", if any. The simplest way is to have a ",(0,t.jsx)(n.code,{children:"Map"}),", where the keys represent the ",(0,t.jsx)(n.em,{children:"name"})," of the command, with the values being ",(0,t.jsx)(n.code,{children:"Command"})," instances."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Add"})," the following inside your ",(0,t.jsx)(n.strong,{children:"main class"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"private static final Map<String, Command> commands = new HashMap<>();\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-19",children:"Step 19"}),"\n",(0,t.jsxs)(n.p,{children:['Let\'s populate this map with a simple "ping pong" command just as a demonstration that the system works. ',(0,t.jsx)(n.strong,{children:"Add"})," the following inside your ",(0,t.jsx)(n.strong,{children:"main class"}),":"]}),"\n",(0,t.jsx)(n.h6,{id:"imperative-approach-1",children:"Imperative Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'static {\r\n    commands.put("ping", event -> event.getMessage()\r\n        .getChannel().block()\r\n        .createMessage("Pong!").block());\r\n}\n'})}),"\n",(0,t.jsx)(n.h6,{id:"reactive-approach-1",children:"Reactive Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'static {\r\n    commands.put("ping", event -> event.getMessage().getChannel()\r\n        .flatMap(channel -> channel.createMessage("Pong!"))\r\n        .then());\r\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:'All this code does is add a mapping to "ping" where the bot will create a new message in the same channel with the text "Pong!".'}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-20",children:"Step 20"}),"\n",(0,t.jsxs)(n.p,{children:["Finally, we need a way to hook up our command system to Discord4J's event system. All of Discord4J's events are dispatched through the ",(0,t.jsx)(n.code,{children:"EventDispatcher"})," that is attached to the ",(0,t.jsx)(n.code,{children:"DiscordClient"})," instance. ",(0,t.jsx)(n.code,{children:"EventDispatcher"})," has a single method, ",(0,t.jsx)(n.code,{children:"on"}),", which determines which type of event the dispatcher should provide us."]}),"\n",(0,t.jsx)(n.p,{children:"After having an event, we need to do some basic filtering to make sure we are executing the right commands for the right messages. To do this, we will simply iterate through all our commands, check if the contents of the message starts with a prefix plus the command we are checking against and, if it does, execute the command."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Discord4J v3.0.x"}),": ",(0,t.jsx)(n.strong,{children:"Add"})," the following code ",(0,t.jsx)(n.strong,{children:"after"})," building the ",(0,t.jsx)(n.code,{children:"DiscordClient"}),", but ",(0,t.jsx)(n.strong,{children:"before"})," ",(0,t.jsx)(n.code,{children:"login"}),":\r\n",(0,t.jsx)(n.strong,{children:"Discord4J v3.1.x"}),": ",(0,t.jsx)(n.strong,{children:"Add"})," the following code ",(0,t.jsx)(n.strong,{children:"after"})," building the ",(0,t.jsx)(n.code,{children:"GatewayDiscordClient"}),", but ",(0,t.jsx)(n.strong,{children:"before"})," ",(0,t.jsx)(n.code,{children:"onDisconnect"}),":"]}),"\n",(0,t.jsx)(n.h6,{id:"discord4j-30x---imperative-approach",children:"Discord4J 3.0.x - Imperative Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'client.getEventDispatcher().on(MessageCreateEvent.class)\r\n    // subscribe is like block, in that it will *request* for action\r\n    // to be done, but instead of blocking the thread, waiting for it\r\n    // to finish, it will just execute the results asynchronously.\r\n    .subscribe(event -> {\r\n        final String content = event.getMessage().getContent().orElse("");\r\n        for (final Map.Entry<String, Command> entry : commands.entrySet()) {\r\n            // We will be using ! as our "prefix" to any command in the system.\r\n            if (content.startsWith(\'!\' + entry.getKey())) {\r\n                entry.getValue().execute(event);\r\n                break;\r\n            }\r\n        }\r\n    });\n'})}),"\n",(0,t.jsx)(n.h6,{id:"discord4j-30x---reactive-approach",children:"Discord4J 3.0.x - Reactive Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"client.getEventDispatcher().on(MessageCreateEvent.class)\r\n    .flatMap(event -> Mono.justOrEmpty(event.getMessage().getContent())\r\n        .flatMap(content -> Flux.fromIterable(commands.entrySet())\r\n            // We will be using ! as our \"prefix\" to any command in the system.\r\n            .filter(entry -> content.startsWith('!' + entry.getKey()))\r\n            .flatMap(entry -> entry.getValue().execute(event))\r\n            .next()))\r\n    .subscribe();\n"})}),"\n",(0,t.jsx)(n.h6,{id:"discord4j-31x---imperative-approach",children:"Discord4J 3.1.x - Imperative Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"client.getEventDispatcher().on(MessageCreateEvent.class)\r\n    // subscribe is like block, in that it will *request* for action\r\n    // to be done, but instead of blocking the thread, waiting for it\r\n    // to finish, it will just execute the results asynchronously.\r\n    .subscribe(event -> {\r\n        // 3.1 Message.getContent() is a String\r\n        final String content = event.getMessage().getContent();\r\n\r\n        for (final Map.Entry<String, Command> entry : commands.entrySet()) {\r\n            // We will be using ! as our \"prefix\" to any command in the system.\r\n            if (content.startsWith('!' + entry.getKey())) {\r\n                entry.getValue().execute(event);\r\n                break;\r\n            }\r\n        }\r\n    });\n"})}),"\n",(0,t.jsx)(n.h6,{id:"discord4j-31x---reactive-approach",children:"Discord4J 3.1.x - Reactive Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"client.getEventDispatcher().on(MessageCreateEvent.class)\r\n    // 3.1 Message.getContent() is a String\r\n    .flatMap(event -> Mono.just(event.getMessage().getContent())\r\n        .flatMap(content -> Flux.fromIterable(commands.entrySet())\r\n            // We will be using ! as our \"prefix\" to any command in the system.\r\n            .filter(entry -> content.startsWith('!' + entry.getKey()))\r\n            .flatMap(entry -> entry.getValue().execute(event))\r\n            .next()))\r\n    .subscribe();\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-21",children:"Step 21"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Rerun"}),' the bot and type "!ping" to any channel the bot can read, and it will promptly respond with "Pong!". Congratulations, you have successfully created your first command and expandable command system. If we need to add a new command, we just simply add another mapping to ',(0,t.jsx)(n.code,{children:"commands"})," in the ",(0,t.jsx)(n.code,{children:"static"})," block that we made in step 18."]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"adding-music",children:"Adding Music"}),"\n",(0,t.jsx)(n.p,{children:"Once we know how to implement commands, let's add a few more with the added ability to playback music. This section will cover how to make our bot join a voice channel and how to playback audio from a YouTube link."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-22",children:"Step 22"}),"\n",(0,t.jsxs)(n.p,{children:["In order to playback audio from a YouTube link we need to be able to extract audio from a YouTube link in a format Discord will recognize. One of the easiest solutions for this is by utilizing ",(0,t.jsx)(n.a,{href:"https://github.com/sedmelluq/lavaplayer",children:"LavaPlayer"}),". So in your ",(0,t.jsx)(n.em,{children:"pom.xml"}),", ",(0,t.jsx)(n.strong,{children:"add"})," the ",(0,t.jsx)(n.strong,{children:"Maven coordinates"})," that ",(0,t.jsx)(n.strong,{children:"LavaPlayer's README"})," specifies."]}),"\n",(0,t.jsx)(n.p,{children:"Important: Version numbers shown in these images might be outdated. While following this tutorial, prefer using the latest version in the 3.1.x line:"}),"\n",(0,t.jsxs)(n.p,{children:["For ",(0,t.jsx)(n.code,{children:"discord4j-core"}),": ",(0,t.jsx)(n.a,{href:"https://search.maven.org/artifact/com.discord4j/discord4j-core",children:(0,t.jsx)(n.img,{src:"https://img.shields.io/maven-central/v/com.discord4j/discord4j-core/3.1.svg?style=flat-square",alt:"Maven Central"})})]}),"\n",(0,t.jsxs)(n.p,{children:["For ",(0,t.jsx)(n.code,{children:"lavaplayer"}),": ",(0,t.jsx)(n.a,{href:"https://bintray.com/sedmelluq/com.sedmelluq/lavaplayer",children:(0,t.jsx)(n.img,{src:"https://api.bintray.com/packages/sedmelluq/com.sedmelluq/lavaplayer/images/download.svg",alt:"Bintray"})})]}),"\n",(0,t.jsx)("img",{src:"/img/music_bot/ij_maven_lavaplayer.png"}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-23",children:"Step 23"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Add"})," the following code at the start of your main class, ",(0,t.jsx)(n.strong,{children:"before"})," building the ",(0,t.jsx)(n.code,{children:"DiscordClient"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"// Creates AudioPlayer instances and translates URLs to AudioTrack instances\r\nfinal AudioPlayerManager playerManager = new DefaultAudioPlayerManager();\r\n\r\n// This is an optimization strategy that Discord4J can utilize.\r\n// It is not important to understand\r\nplayerManager.getConfiguration()\r\n    .setFrameBufferFactory(NonAllocatingAudioFrameBuffer::new);\r\n\r\n// Allow playerManager to parse remote sources like YouTube links\r\nAudioSourceManagers.registerRemoteSources(playerManager);\r\n\r\n// Create an AudioPlayer so Discord4J can receive audio data\r\nfinal AudioPlayer player = playerManager.createPlayer();\r\n\r\n// We will be creating LavaPlayerAudioProvider in the next step\r\nAudioProvider provider = new LavaPlayerAudioProvider(player);\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-24",children:"Step 24"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Create"})," the following class:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public final class LavaPlayerAudioProvider extends AudioProvider {\r\n\r\n    private final AudioPlayer player;\r\n    private final MutableAudioFrame frame = new MutableAudioFrame();\r\n\r\n    public LavaPlayerAudioProvider(final AudioPlayer player) {\r\n        // Allocate a ByteBuffer for Discord4J's AudioProvider to hold audio data\r\n        // for Discord\r\n        super(\r\n            ByteBuffer.allocate(\r\n                StandardAudioDataFormats.DISCORD_OPUS.maximumChunkSize()\r\n            )\r\n        );\r\n        // Set LavaPlayer's MutableAudioFrame to use the same buffer as the one we\r\n        // just allocated\r\n        frame.setBuffer(getBuffer());\r\n        this.player = player;\r\n    }\r\n\r\n    @Override\r\n    public boolean provide() {\r\n        // AudioPlayer writes audio data to its AudioFrame\r\n        final boolean didProvide = player.provide(frame);\r\n        // If audio was provided, flip from write-mode to read-mode\r\n        if (didProvide) {\r\n            getBuffer().flip();\r\n        }\r\n        return didProvide;\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-25",children:"Step 25"}),"\n",(0,t.jsx)(n.p,{children:'Once Discord4J and LavaPlayer are linked together, we need to have our bot be able to join voice channels to playback music. As a very simple demonstration, we will be adding a "join" command where the bot will join the voice channel of the user who made the request.'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Add"})," the following code after creating the ",(0,t.jsx)(n.code,{children:"AudioProvider"})," instance from step 23."]}),"\n",(0,t.jsx)(n.h6,{id:"imperative-approach-2",children:"Imperative Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'commands.put("join", event -> {\r\n    final Member member = event.getMember().orElse(null);\r\n    if (member != null) {\r\n        final VoiceState voiceState = member.getVoiceState().block();\r\n        if (voiceState != null) {\r\n            final VoiceChannel channel = voiceState.getChannel().block();\r\n            if (channel != null) {\r\n                // join returns a VoiceConnection which would be required if we were\r\n                // adding disconnection features, but for now we are just ignoring it.\r\n                channel.join(spec -> spec.setProvider(provider)).block();\r\n            }\r\n        }\r\n    }\r\n});\n'})}),"\n",(0,t.jsx)(n.h6,{id:"reactive-approach-2",children:"Reactive Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'commands.put("join", event -> Mono.justOrEmpty(event.getMember())\r\n    .flatMap(Member::getVoiceState)\r\n    .flatMap(VoiceState::getChannel)\r\n    // join returns a VoiceConnection which would be required if we were\r\n    // adding disconnection features, but for now we are just ignoring it.\r\n    .flatMap(channel -> channel.join(spec -> spec.setProvider(provider)))\r\n    .then());\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-26",children:"Step 26"}),"\n",(0,t.jsxs)(n.p,{children:["Finally, let's add a command that takes a YouTube link, extracts audio from it, and plays it back to the channel. First, we need to make a class taking processed ",(0,t.jsx)(n.code,{children:"AudioTrack"})," instances and loads them into an ",(0,t.jsx)(n.code,{children:"AudioPlayer"}),'. The class this tutorial will make is the most basic implementation, but it is possible to design a "queue" system rather than an overriding system with a bit more requisite knowledge outside the scope of this tutorial.']}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Create"})," the following class:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public final class TrackScheduler implements AudioLoadResultHandler {\r\n\r\n    private final AudioPlayer player;\r\n\r\n    public TrackScheduler(final AudioPlayer player) {\r\n        this.player = player;\r\n    }\r\n\r\n    @Override\r\n    public void trackLoaded(final AudioTrack track) {\r\n        // LavaPlayer found an audio source for us to play\r\n        player.playTrack(track);\r\n    }\r\n\r\n    @Override\r\n    public void playlistLoaded(final AudioPlaylist playlist) {\r\n        // LavaPlayer found multiple AudioTracks from some playlist\r\n    }\r\n\r\n    @Override\r\n    public void noMatches() {\r\n        // LavaPlayer did not find any audio to extract\r\n    }\r\n\r\n    @Override\r\n    public void loadFailed(final FriendlyException exception) {\r\n        // LavaPlayer could not parse an audio source for some reason\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-27",children:"Step 27"}),"\n",(0,t.jsx)(n.p,{children:'Now, let\'s add the command. We are going to add a "play" command, but with an additional technique to extract arguments from it. We will not be doing any sort of validation (i.e., check if the argument exists or if there are more than 1 arguments), but it would likely be a good idea to do so at a later date.'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Add"}),' the following code right after your "join" command.']}),"\n",(0,t.jsx)(n.h6,{id:"imperative-approach-3",children:"Imperative Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'final TrackScheduler scheduler = new TrackScheduler(player);\r\ncommands.put("play", event -> {\r\n    final String content = event.getMessage().getContent().get();\r\n    final List<String> command = Arrays.asList(content.split(" "));\r\n    playerManager.loadItem(command.get(1), scheduler);\r\n});\n'})}),"\n",(0,t.jsx)(n.h6,{id:"reactive-approach-3",children:"Reactive Approach"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:'final TrackScheduler scheduler = new TrackScheduler(player);\r\ncommands.put("play", event -> Mono.justOrEmpty(event.getMessage().getContent())\r\n    .map(content -> Arrays.asList(content.split(" ")))\r\n    .doOnNext(command -> playerManager.loadItem(command.get(1), scheduler))\r\n    .then());\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h4,{id:"step-28",children:"Step 28"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Rerun"})," your bot and join a voice channel that the bot can also join. Type ",(0,t.jsx)(n.code,{children:"!join"})," and then type ",(0,t.jsx)(n.code,{children:"!play https://www.youtube.com/watch?v=dQw4w9WgXcQ"}),". Congratulations! You now have a bot that can parse commands, have an expandable command system, can join voice channels, and playback audio from YouTube (and other sources LavaPlayer supports)."]}),"\n",(0,t.jsxs)(n.p,{children:["That is the conclusion of this tutorial! If you have any questions or issues, you may ask in the ",(0,t.jsx)(n.a,{href:"https://discord.gg/d4j",children:"Discord4J Discord server"}),". Feedback is also welcomed, and thank you for your interest in learning Discord4J."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>o});var t=i(6540);const r={},a=t.createContext(r);function s(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);